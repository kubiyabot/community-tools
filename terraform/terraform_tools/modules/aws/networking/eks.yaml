name: EKS with Node Groups
description: EKS cluster with managed node groups
source: terraform-aws-modules/eks/aws
version: 19.0.0
auto_discover: false

variables:
  cluster_name:
    type: string
    required: true
    description: Name of the EKS cluster
    validation:
      - condition: can(regex("^[a-zA-Z][a-zA-Z0-9-]*$", var.cluster_name))
        error: Cluster name must start with letter and only contain alphanumeric characters and hyphens
  
  cluster_version:
    type: string
    default: "1.27"
    description: Kubernetes version to use
  
  vpc_id:
    type: string
    required: true
    description: VPC where the cluster and workers will be deployed
  
  subnet_ids:
    type: list
    required: true
    description: A list of subnet IDs where the nodes/node groups will be deployed
  
  node_groups:
    type: map
    description: Map of node group configurations
    schema:
      instance_type:
        type: string
        default: t3.medium
        description: EC2 instance type for the node group
      min_size:
        type: number
        default: 1
        description: Minimum number of nodes
      max_size:
        type: number
        default: 3
        description: Maximum number of nodes
      desired_size:
        type: number
        default: 2
        description: Desired number of nodes

    generate:
      eks_managed_node_groups:
        for_each: ${node_groups}
        ${each.key}:
          instance_type: ${each.value.instance_type}
          min_size: ${each.value.min_size}
          max_size: ${each.value.max_size}
          desired_size: ${each.value.desired_size} 