// src/overrides/CodeOverride.tsx
import { useContext } from "react";
import { PreContext } from "./PreOverride.mjs";
import { DefaultCodeBlock } from "./CodeBlock.mjs";
import { useCallbackRef } from "@radix-ui/react-use-callback-ref";
import { withDefaultProps } from "./withDefaults.mjs";
import { DefaultCodeBlockContent } from "./defaultComponents.mjs";
import { jsx } from "react/jsx-runtime";
var CodeBlockOverride = ({
  components: {
    Pre,
    Code,
    SyntaxHighlighter: FallbackSyntaxHighlighter,
    CodeHeader: FallbackCodeHeader
  },
  componentsByLanguage = {},
  children,
  node,
  ...codeProps
}) => {
  const preProps = useContext(PreContext);
  const getPreProps = withDefaultProps(preProps);
  const WrappedPre = useCallbackRef((props) => /* @__PURE__ */ jsx(Pre, { ...getPreProps(props) }));
  const getCodeProps = withDefaultProps(codeProps);
  const WrappedCode = useCallbackRef((props) => /* @__PURE__ */ jsx(Code, { ...getCodeProps(props) }));
  const language = /language-(\w+)/.exec(codeProps.className || "")?.[1] ?? "";
  if (typeof children !== "string") {
    return /* @__PURE__ */ jsx(
      DefaultCodeBlockContent,
      {
        components: { Pre: WrappedPre, Code: WrappedCode },
        code: children,
        node
      }
    );
  }
  const SyntaxHighlighter = componentsByLanguage[language]?.SyntaxHighlighter ?? FallbackSyntaxHighlighter;
  const CodeHeader = componentsByLanguage[language]?.CodeHeader ?? FallbackCodeHeader;
  return /* @__PURE__ */ jsx(
    DefaultCodeBlock,
    {
      components: {
        Pre: WrappedPre,
        Code: WrappedCode,
        SyntaxHighlighter,
        CodeHeader
      },
      language: language || "unknown",
      code: children,
      node
    }
  );
};
var CodeOverride = ({
  components,
  componentsByLanguage,
  ...props
}) => {
  const preProps = useContext(PreContext);
  if (!preProps) return /* @__PURE__ */ jsx(components.Code, { ...props });
  return /* @__PURE__ */ jsx(
    CodeBlockOverride,
    {
      components,
      componentsByLanguage,
      ...props
    }
  );
};
export {
  CodeOverride
};
//# sourceMappingURL=CodeOverride.mjs.map