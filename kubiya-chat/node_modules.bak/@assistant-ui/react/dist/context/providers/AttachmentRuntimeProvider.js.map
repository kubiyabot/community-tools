{"version":3,"sources":["../../../src/context/providers/AttachmentRuntimeProvider.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  type FC,\n  type PropsWithChildren,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { create } from \"zustand\";\nimport { AttachmentContext } from \"../react/AttachmentContext\";\nimport { writableStore } from \"../ReadonlyStore\";\nimport { AttachmentRuntime } from \"../../api/AttachmentRuntime\";\n\nexport namespace AttachmentRuntimeProvider {\n  export type Props = PropsWithChildren<{\n    runtime: AttachmentRuntime;\n  }>;\n}\n\nconst useAttachmentRuntimeStore = (runtime: AttachmentRuntime) => {\n  const [store] = useState(() => create(() => runtime));\n\n  useEffect(() => {\n    writableStore(store).setState(runtime, true);\n  }, [runtime, store]);\n\n  return store;\n};\nconst useAttachmentStore = (runtime: AttachmentRuntime) => {\n  const [store] = useState(() => create(() => runtime.getState()));\n  useEffect(() => {\n    const updateState = () =>\n      writableStore(store).setState(runtime.getState(), true);\n    updateState();\n    return runtime.subscribe(updateState);\n  }, [runtime, store]);\n\n  return store;\n};\n\nexport const AttachmentRuntimeProvider: FC<AttachmentRuntimeProvider.Props> = ({\n  runtime,\n  children,\n}) => {\n  const useAttachmentRuntime = useAttachmentRuntimeStore(runtime);\n  const useAttachment = useAttachmentStore(runtime);\n  const source = useAttachment((s) => s.source);\n  const context = useMemo(() => {\n    return {\n      source,\n      useAttachmentRuntime,\n      useAttachment,\n    };\n  }, [useAttachmentRuntime, useAttachment]);\n\n  return (\n    <AttachmentContext.Provider value={context}>\n      {children}\n    </AttachmentContext.Provider>\n  );\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,mBAMO;AACP,qBAAuB;AACvB,+BAAkC;AAClC,2BAA8B;AA8C1B;AArCJ,IAAM,4BAA4B,CAAC,YAA+B;AAChE,QAAM,CAAC,KAAK,QAAI,uBAAS,UAAM,uBAAO,MAAM,OAAO,CAAC;AAEpD,8BAAU,MAAM;AACd,4CAAc,KAAK,EAAE,SAAS,SAAS,IAAI;AAAA,EAC7C,GAAG,CAAC,SAAS,KAAK,CAAC;AAEnB,SAAO;AACT;AACA,IAAM,qBAAqB,CAAC,YAA+B;AACzD,QAAM,CAAC,KAAK,QAAI,uBAAS,UAAM,uBAAO,MAAM,QAAQ,SAAS,CAAC,CAAC;AAC/D,8BAAU,MAAM;AACd,UAAM,cAAc,UAClB,oCAAc,KAAK,EAAE,SAAS,QAAQ,SAAS,GAAG,IAAI;AACxD,gBAAY;AACZ,WAAO,QAAQ,UAAU,WAAW;AAAA,EACtC,GAAG,CAAC,SAAS,KAAK,CAAC;AAEnB,SAAO;AACT;AAEO,IAAM,4BAAiE,CAAC;AAAA,EAC7E;AAAA,EACA;AACF,MAAM;AACJ,QAAM,uBAAuB,0BAA0B,OAAO;AAC9D,QAAM,gBAAgB,mBAAmB,OAAO;AAChD,QAAM,SAAS,cAAc,CAAC,MAAM,EAAE,MAAM;AAC5C,QAAM,cAAU,sBAAQ,MAAM;AAC5B,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF,GAAG,CAAC,sBAAsB,aAAa,CAAC;AAExC,SACE,4CAAC,2CAAkB,UAAlB,EAA2B,OAAO,SAChC,UACH;AAEJ;","names":[]}