"use strict";
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/runtimes/remote-thread-list/cloud/AssistantCloudAuthStrategy.tsx
var AssistantCloudAuthStrategy_exports = {};
__export(AssistantCloudAuthStrategy_exports, {
  AssistantCloudAPIKeyAuthStrategy: () => AssistantCloudAPIKeyAuthStrategy,
  AssistantCloudJWTAuthStrategy: () => AssistantCloudJWTAuthStrategy
});
module.exports = __toCommonJS(AssistantCloudAuthStrategy_exports);
var AssistantCloudJWTAuthStrategy = class {
  strategy = "jwt";
  cachedToken = null;
  tokenExpiry = null;
  #projectId;
  #authTokenCallback;
  constructor(projectId, authTokenCallback) {
    this.#projectId = projectId;
    this.#authTokenCallback = authTokenCallback;
  }
  getJwtExpiry(jwt) {
    try {
      const bodyPart = jwt.split(".").at(1);
      if (!bodyPart) {
        throw new Error("Invalid JWT format");
      }
      const payload = Buffer.from(
        bodyPart.replace(/-/g, "+").replace(/_/g, "/"),
        "base64"
      ).toString();
      const payloadObj = JSON.parse(payload);
      const exp = payloadObj.exp;
      if (!exp || typeof exp !== "number") {
        throw new Error('JWT does not contain a valid "exp" field');
      }
      return exp * 1e3;
    } catch (error) {
      throw new Error("Unable to determine the token expiry " + error);
    }
  }
  async getAuthHeaders() {
    const currentTime = Date.now();
    if (this.cachedToken && this.tokenExpiry && this.tokenExpiry - currentTime > 30 * 1e3) {
      return {
        Authorization: `Bearer ${this.cachedToken}`,
        "Aui-Project-Id": this.#projectId
      };
    }
    const newToken = await this.#authTokenCallback();
    const expiry = this.getJwtExpiry(newToken);
    this.cachedToken = newToken;
    this.tokenExpiry = expiry;
    return {
      Authorization: `Bearer ${newToken}`,
      "Aui-Project-Id": this.#projectId
    };
  }
};
var AssistantCloudAPIKeyAuthStrategy = class {
  strategy = "api-key";
  #apiKey;
  #workspaceId;
  constructor(apiKey, workspaceId) {
    this.#apiKey = apiKey;
    this.#workspaceId = workspaceId;
  }
  async getAuthHeaders() {
    return {
      Authorization: `Bearer ${this.#apiKey}`,
      "Aui-Workspace-Id": this.#workspaceId
    };
  }
};
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  AssistantCloudAPIKeyAuthStrategy,
  AssistantCloudJWTAuthStrategy
});
//# sourceMappingURL=AssistantCloudAuthStrategy.js.map