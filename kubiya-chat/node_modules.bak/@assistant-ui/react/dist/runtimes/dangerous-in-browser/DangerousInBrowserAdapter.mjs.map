{"version":3,"sources":["../../../src/runtimes/dangerous-in-browser/DangerousInBrowserAdapter.ts"],"sourcesContent":["import {\n  ChatModelAdapter,\n  ChatModelRunOptions,\n} from \"../local/ChatModelAdapter\";\nimport { toCoreMessages } from \"../edge/converters/toCoreMessages\";\nimport { toLanguageModelTools } from \"../edge/converters/toLanguageModelTools\";\nimport { EdgeRuntimeRequestOptions } from \"../edge/EdgeRuntimeRequestOptions\";\nimport { runResultStream } from \"../edge/streams/runResultStream\";\nimport { toolResultStream } from \"../edge/streams/toolResultStream\";\nimport { asAsyncIterable } from \"../edge/EdgeChatAdapter\";\nimport {\n  CreateEdgeRuntimeAPIOptions,\n  getEdgeRuntimeStream,\n} from \"../edge/createEdgeRuntimeAPI\";\n\nexport type DangerousInBrowserAdapterOptions = CreateEdgeRuntimeAPIOptions;\n\nexport class DangerousInBrowserAdapter implements ChatModelAdapter {\n  constructor(private options: DangerousInBrowserAdapterOptions) {}\n\n  async *run({ messages, abortSignal, config }: ChatModelRunOptions) {\n    const res = await getEdgeRuntimeStream({\n      options: this.options,\n      abortSignal,\n      requestData: {\n        system: config.system,\n        messages: toCoreMessages(messages),\n        tools: config.tools ? toLanguageModelTools(config.tools) : [],\n        ...config.callSettings,\n        ...config.config,\n      } satisfies EdgeRuntimeRequestOptions,\n    });\n\n    const stream = res\n      .pipeThrough(toolResultStream(config.tools, abortSignal))\n      .pipeThrough(runResultStream());\n\n    for await (const update of asAsyncIterable(stream)) {\n      yield update;\n    }\n  }\n}\n"],"mappings":";AAIA,SAAS,sBAAsB;AAC/B,SAAS,4BAA4B;AAErC,SAAS,uBAAuB;AAChC,SAAS,wBAAwB;AACjC,SAAS,uBAAuB;AAChC;AAAA,EAEE;AAAA,OACK;AAIA,IAAM,4BAAN,MAA4D;AAAA,EACjE,YAAoB,SAA2C;AAA3C;AAAA,EAA4C;AAAA,EAEhE,OAAO,IAAI,EAAE,UAAU,aAAa,OAAO,GAAwB;AACjE,UAAM,MAAM,MAAM,qBAAqB;AAAA,MACrC,SAAS,KAAK;AAAA,MACd;AAAA,MACA,aAAa;AAAA,QACX,QAAQ,OAAO;AAAA,QACf,UAAU,eAAe,QAAQ;AAAA,QACjC,OAAO,OAAO,QAAQ,qBAAqB,OAAO,KAAK,IAAI,CAAC;AAAA,QAC5D,GAAG,OAAO;AAAA,QACV,GAAG,OAAO;AAAA,MACZ;AAAA,IACF,CAAC;AAED,UAAM,SAAS,IACZ,YAAY,iBAAiB,OAAO,OAAO,WAAW,CAAC,EACvD,YAAY,gBAAgB,CAAC;AAEhC,qBAAiB,UAAU,gBAAgB,MAAM,GAAG;AAClD,YAAM;AAAA,IACR;AAAA,EACF;AACF;","names":[]}