{"version":3,"sources":["../../src/ui/composer.tsx"],"sourcesContent":["\"use client\";\n\nimport { ComponentPropsWithoutRef, forwardRef, type FC } from \"react\";\n\nimport { PaperclipIcon, SendHorizontalIcon } from \"lucide-react\";\nimport { withDefaults } from \"./utils/withDefaults\";\nimport { useThreadConfig } from \"./thread-config\";\nimport { TooltipIconButton } from \"./base/tooltip-icon-button\";\nimport { CircleStopIcon } from \"./base/CircleStopIcon\";\nimport { ComposerPrimitive, ThreadPrimitive } from \"../primitives\";\nimport { useThread } from \"../context/react/ThreadContext\";\nimport Attachment from \"./attachment-ui\";\n\nconst useAllowAttachments = (ensureCapability = false) => {\n  const { composer: { allowAttachments = true } = {} } = useThreadConfig();\n  const attachmentsSupported = useThread((t) => t.capabilities.attachments);\n  return allowAttachments && (!ensureCapability || attachmentsSupported);\n};\n\nconst Composer: FC = () => {\n  const allowAttachments = useAllowAttachments(true);\n  return (\n    <ComposerRoot>\n      {allowAttachments && <ComposerAttachments />}\n      {allowAttachments && <ComposerAddAttachment />}\n      <ComposerInput autoFocus />\n      <ComposerAction />\n    </ComposerRoot>\n  );\n};\n\nComposer.displayName = \"Composer\";\n\nconst ComposerRoot = withDefaults(ComposerPrimitive.Root, {\n  className: \"aui-composer-root\",\n});\n\nComposerRoot.displayName = \"ComposerRoot\";\n\nconst ComposerInputStyled = withDefaults(ComposerPrimitive.Input, {\n  rows: 1,\n  autoFocus: true,\n  className: \"aui-composer-input\",\n});\n\nnamespace ComposerInput {\n  export type Element = HTMLTextAreaElement;\n  export type Props = ComponentPropsWithoutRef<typeof ComposerInputStyled>;\n}\n\nconst ComposerInput = forwardRef<ComposerInput.Element, ComposerInput.Props>(\n  (props, ref) => {\n    const {\n      strings: {\n        composer: { input: { placeholder = \"Write a message...\" } = {} } = {},\n      } = {},\n    } = useThreadConfig();\n    return (\n      <ComposerInputStyled placeholder={placeholder} {...props} ref={ref} />\n    );\n  },\n);\n\nComposerInput.displayName = \"ComposerInput\";\n\nconst ComposerAttachmentsContainer = withDefaults(\"div\", {\n  className: \"aui-composer-attachments\",\n});\n\nnamespace ComposerAttachments {\n  export type Props = Partial<ComposerPrimitive.Attachments.Props>;\n}\n\nconst ComposerAttachments: FC<ComposerAttachments.Props> = ({ components }) => {\n  return (\n    <ComposerAttachmentsContainer>\n      <ComposerPrimitive.Attachments\n        components={{\n          ...components,\n          Attachment: components?.Attachment ?? Attachment,\n        }}\n      />\n    </ComposerAttachmentsContainer>\n  );\n};\n\nconst ComposerAttachButton = withDefaults(TooltipIconButton, {\n  variant: \"default\",\n  className: \"aui-composer-attach\",\n});\n\nnamespace ComposerAddAttachment {\n  export type Element = HTMLButtonElement;\n  export type Props = Partial<TooltipIconButton.Props>;\n}\n\nconst ComposerAddAttachment = forwardRef<\n  ComposerAddAttachment.Element,\n  ComposerAddAttachment.Props\n>((props, ref) => {\n  const {\n    strings: {\n      composer: { addAttachment: { tooltip = \"Attach file\" } = {} } = {},\n    } = {},\n  } = useThreadConfig();\n  const allowAttachments = useAllowAttachments();\n  return (\n    <ComposerPrimitive.AddAttachment disabled={!allowAttachments} asChild>\n      <ComposerAttachButton\n        tooltip={tooltip}\n        variant={\"ghost\"}\n        {...props}\n        ref={ref}\n      >\n        {props.children ?? <PaperclipIcon />}\n      </ComposerAttachButton>\n    </ComposerPrimitive.AddAttachment>\n  );\n});\n\nComposerAddAttachment.displayName = \"ComposerAddAttachment\";\n\nconst useAllowCancel = () => {\n  const cancelSupported = useThread((t) => t.capabilities.cancel);\n  return cancelSupported;\n};\n\nconst ComposerAction: FC = () => {\n  const allowCancel = useAllowCancel();\n  if (!allowCancel) return <ComposerSend />;\n  return (\n    <>\n      <ThreadPrimitive.If running={false}>\n        <ComposerSend />\n      </ThreadPrimitive.If>\n      <ThreadPrimitive.If running>\n        <ComposerCancel />\n      </ThreadPrimitive.If>\n    </>\n  );\n};\n\nComposerAction.displayName = \"ComposerAction\";\n\nconst ComposerSendButton = withDefaults(TooltipIconButton, {\n  variant: \"default\",\n  className: \"aui-composer-send\",\n});\n\nnamespace ComposerSend {\n  export type Element = HTMLButtonElement;\n  export type Props = Partial<TooltipIconButton.Props>;\n}\n\nconst ComposerSend = forwardRef<ComposerSend.Element, ComposerSend.Props>(\n  (props, ref) => {\n    const {\n      strings: { composer: { send: { tooltip = \"Send\" } = {} } = {} } = {},\n    } = useThreadConfig();\n    return (\n      <ComposerPrimitive.Send asChild>\n        <ComposerSendButton tooltip={tooltip} {...props} ref={ref}>\n          {props.children ?? <SendHorizontalIcon />}\n        </ComposerSendButton>\n      </ComposerPrimitive.Send>\n    );\n  },\n);\n\nComposerSend.displayName = \"ComposerSend\";\n\nconst ComposerCancelButton = withDefaults(TooltipIconButton, {\n  variant: \"default\",\n  className: \"aui-composer-cancel\",\n});\n\nnamespace ComposerCancel {\n  export type Element = HTMLButtonElement;\n  export type Props = Partial<TooltipIconButton.Props>;\n}\n\nconst ComposerCancel = forwardRef<ComposerCancel.Element, ComposerCancel.Props>(\n  (props, ref) => {\n    const {\n      strings: { composer: { cancel: { tooltip = \"Cancel\" } = {} } = {} } = {},\n    } = useThreadConfig();\n    return (\n      <ComposerPrimitive.Cancel asChild>\n        <ComposerCancelButton tooltip={tooltip} {...props} ref={ref}>\n          {props.children ?? <CircleStopIcon />}\n        </ComposerCancelButton>\n      </ComposerPrimitive.Cancel>\n    );\n  },\n);\n\nComposerCancel.displayName = \"ComposerCancel\";\n\nconst exports = {\n  Root: ComposerRoot,\n  Input: ComposerInput,\n  Action: ComposerAction,\n  Send: ComposerSend,\n  Cancel: ComposerCancel,\n  AddAttachment: ComposerAddAttachment,\n  Attachments: ComposerAttachments,\n};\n\nexport default Object.assign(Composer, exports) as typeof Composer &\n  typeof exports;\n"],"mappings":"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","names":[]}