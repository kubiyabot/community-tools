version: "1"
filter:
  watch_for:
    - kind: Pod
      reasons: 
        - "*BackOff*"
        - "*Error*"
        - "*Failed*"
        - "*OOMKilled*"
        - "*Evicted*"
      severity: critical
      prompt: |
        ğŸš¨ Critical Pod Issue Detected!
        
        Pod Details:
        ğŸ“¦ Pod: {{.Name}}
        ğŸŒ Namespace: {{.Namespace}}
        ğŸ”„ Status: {{.Phase}}
        âŒ Issue: {{.WaitingReason}}
        â„¹ï¸ Details: {{.WaitingMessage}}
        ğŸ”‹ Container State: {{.ContainerState}}
        ğŸ” Restart Count: {{.RestartCount}}
        {{if .ExitCode}}ğŸšª Exit Code: {{.ExitCode}}{{end}}
        {{if .LastTerminationReason}}
        ğŸ” Last Termination: {{.LastTerminationReason}}
        ğŸ“ Last Termination Message: {{.LastTerminationMessage}}
        {{end}}

        ğŸ› ï¸ Troubleshooting Steps:
        1ï¸âƒ£ View current logs:
           $ kubectl logs {{.Name}} -n {{.Namespace}}
        
        2ï¸âƒ£ Check previous container logs:
           $ kubectl logs {{.Name}} -n {{.Namespace}} --previous
        
        3ï¸âƒ£ Inspect pod details:
           $ kubectl describe pod {{.Name}} -n {{.Namespace}}
        
        4ï¸âƒ£ Review related events:
           $ kubectl get events -n {{.Namespace}} --field-selector involvedObject.name={{.Name}}
        
        5ï¸âƒ£ Check resource usage:
           $ kubectl top pod {{.Name}} -n {{.Namespace}}

        âš¡ Quick Actions:
        â€¢ Delete pod: kubectl delete pod {{.Name}} -n {{.Namespace}}
        â€¢ Debug with shell: kubectl debug {{.Name}} -n {{.Namespace}} --image=busybox -it
        â€¢ Copy logs: kubectl logs {{.Name}} -n {{.Namespace}} > {{.Name}}.log

    - kind: Node
      reasons:
        - "*NotReady*"
        - "*Pressure*"
        - "*DiskPressure*"
        - "*MemoryPressure*"
        - "*NetworkUnavailable*"
      severity: critical
      prompt: |
        ğŸ”¥ Critical Node Issue Detected!

        Node Information:
        ğŸ–¥ï¸ Node: {{.Name}}
        âš ï¸ Status: {{.Reason}}
        ğŸ“ Message: {{.Message}}
        ğŸ•’ Time: {{.Timestamp}}
        ğŸ”¢ Count: {{.Count}}

        ğŸ’¥ Impact Assessment:
        â€¢ Node issues may affect workload availability
        â€¢ Pods might be rescheduled or evicted
        â€¢ Services might experience disruption

        ğŸ› ï¸ Required Actions:
        1ï¸âƒ£ Check node status:
           $ kubectl describe node {{.Name}}
        
        2ï¸âƒ£ Monitor resource usage:
           $ kubectl top node {{.Name}}
        
        3ï¸âƒ£ Review node events:
           $ kubectl get events --field-selector involvedObject.name={{.Name}},involvedObject.kind=Node
        
        4ï¸âƒ£ Check node logs:
           $ kubectl logs -n kube-system {{.Name}}
        
        5ï¸âƒ£ Verify node conditions:
           $ kubectl get node {{.Name}} -o json | jq .status.conditions

        âš¡ Quick Actions:
        â€¢ Cordon node: kubectl cordon {{.Name}}
        â€¢ Drain node: kubectl drain {{.Name}} --ignore-daemonsets
        â€¢ Uncordon node: kubectl uncordon {{.Name}}

    - kind: Deployment
      reasons:
        - "*FailedCreate*"
        - "*ProgressDeadlineExceeded*"
      severity: warning
      prompt: |
        âš ï¸ Deployment Issue Detected!

        Deployment Details:
        ğŸš€ Deployment: {{.Name}}
        ğŸŒ Namespace: {{.Namespace}}
        âŒ Issue: {{.Reason}}
        ğŸ“ Message: {{.Message}}

        ğŸ” Troubleshooting Steps:
        1ï¸âƒ£ Check deployment status:
           $ kubectl rollout status deployment/{{.Name}} -n {{.Namespace}}
        
        2ï¸âƒ£ View deployment details:
           $ kubectl describe deployment {{.Name}} -n {{.Namespace}}
        
        3ï¸âƒ£ Check replica sets:
           $ kubectl get rs -l app={{.Name}} -n {{.Namespace}}

        âš¡ Quick Actions:
        â€¢ Rollback: kubectl rollout undo deployment/{{.Name}} -n {{.Namespace}}
        â€¢ Scale down: kubectl scale deployment/{{.Name}} -n {{.Namespace}} --replicas=0
        â€¢ Pause rollout: kubectl rollout pause deployment/{{.Name}} -n {{.Namespace}}

  # namespaces:  # uncomment to filter by namespaces
  settings:
    dedup_interval: 2m
    include_labels: true
    include_annotations: true

handler:
  webhook:
    url: "https://webhook-test.com/1d0ca9e26150baaf85f85b1a7ba2a1c2"
    cert: ""
    tlsSkip: true

resource:
  pod: true
  node: true
  deployment: true
  service: true
  event: true
  configmap: true
  secret: false
  namespace: true
  replicaset: true
  daemonset: true
  statefulset: true
  job: true
  cronjob: true